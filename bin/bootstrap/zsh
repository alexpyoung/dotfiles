#!/usr/bin/env bash

set -o pipefail

install_ohmyzsh() {
    if [[ -d ~/.oh-my-zsh ]]; then
        return
    else
        sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
    fi
}

install_spaceship() {
    if [[ -d ~/.oh-my-zsh/themes/spaceship-prompt ]]; then
        return
    else
        git clone https://github.com/denysdovhan/spaceship-prompt.git "$ZSH/themes/spaceship-prompt"
        ln -Ffsv "$ZSH/themes/spaceship-prompt/spaceship.zsh-theme" "$ZSH/themes/spaceship.zsh-theme"
    fi
}

main() {
    local -r ROOT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd)/../.."
    # Dev dependencies
    mkdir -p ~/.pyenv ~/.rbenv ~/.nodenv
    ln -Ffsv "$ROOT_DIR/.pyenv/version" ~/.pyenv/version
    ln -Ffsv "$ROOT_DIR/.rbenv/version" ~/.rbenv/version
    ln -Ffsv "$ROOT_DIR/.nodenv/version" ~/.nodenv/version
    # Plugins
    install_ohmyzsh
    mkdir -p ~/.oh-my-zsh/custom
    ln -Ffsv "$ROOT_DIR/zsh/plugins" ~/.oh-my-zsh/custom
    install_spaceship
    # Run commands
    ln -Ffsv "$ROOT_DIR/.aliases" ~/.aliases
    ln -Ffsv "$ROOT_DIR/.exports" ~/.exports
    ln -Ffsv "$ROOT_DIR/.functions" ~/.functions
    ln -Ffsv "$ROOT_DIR/.zshrc" ~/.zshrc
    # shellcheck disable=SC1090
    source ~/.zshrc
}

main
