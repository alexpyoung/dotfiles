#!/usr/bin/env bash

set -eo pipefail

import_secret_key() {
    local -r UUID=sxwjjzpdgndurmevma5ozxlxei
    [[ -z $GPG_PASSPHRASE ]] && read -s -r -p "Enter GPG passphrase: " GPG_PASSPHRASE
    echo -e "$(op get item "$UUID" | jq -r '.details.password')" | gpg --batch --passphrase "$GPG_PASSPHRASE" --import
}

# batch mode:
# export GPG_PASSPHRASE=...
# export OP_SECRET_KEY=...
main() {
    stow --verbose=2 git
    eval "$(op signin my alexyoung1992@gmail.com "$OP_SECRET_KEY")"
    import_secret_key
}

main
